//CHECKSUM:ed44e682543f7db7479dbba95b31edad4f078cd9d82166784fb047bef91a9fe7
{"version":3,"sources":["../hooks/after_stage_changed/.stage_changed.js"],"names":["stageChanged","previousBotConfig","pipeline_status","stage_request","requested_by","requesterEmail","promoted_by","id","newStage","bot","current_stage","console","log"],"mappings":"AAAA;AAEA;;;;;;;;;;AASA,MAAMA,YAAY,GAAG,YAAY;AAC/B;AACA;AACA,MAAI,CAACC,iBAAiB,CAACC,eAAlB,CAAkCC,aAAvC,EAAsD;AACpD;AACD;;AACD,QAAM;AAAEC,IAAAA,YAAY,EAAEC;AAAhB,MAAmCJ,iBAAiB,CAACC,eAAlB,CAAkCC,aAA3E;AACA,QAAM;AAAEG,IAAAA,WAAF;AAAeC,IAAAA,EAAE,EAAEC;AAAnB,MAAgCC,GAAG,CAACP,eAAJ,CAAoBQ,aAA1D;;AACA,MAAIL,cAAc,IAAIC,WAAW,KAAKD,cAAtC,EAAsD;AACpD;AACAM,IAAAA,OAAO,CAACC,GAAR,CAAa,YAAWH,GAAG,CAACF,EAAG,0BAAyBC,QAAS,OAAMF,WAAY,EAAnF;AACD;AACF,CAZD;;AAcA,OAAON,YAAY,EAAnB","sourceRoot":"/var/lib/jenkins/workspace/build-linux/modules/builtin/src/backend","sourcesContent":["'use strict'\n\n/**\n * This is called when the bot is on a new stage.\n *\n * @param bp The botpress SDK\n * @param previousBotConfig The complete configuration of the bot before stage change request\n * @param bot The complete configuration of the bot\n * @param users The list of users of that workspace (email, role)\n * @param stages The list of configured stages\n */\nconst stageChanged = async () => {\n  // Any custom logic would go here\n  // For example, send an email to the person who requested the stage change\n  if (!previousBotConfig.pipeline_status.stage_request) {\n    return\n  }\n  const { requested_by: requesterEmail } = previousBotConfig.pipeline_status.stage_request\n  const { promoted_by, id: newStage } = bot.pipeline_status.current_stage\n  if (requesterEmail && promoted_by !== requesterEmail) {\n    // Send the email here\n    console.log(`Your bot ${bot.id} was promoted to stage ${newStage} by ${promoted_by}`)\n  }\n}\n\nreturn stageChanged()\n"]}