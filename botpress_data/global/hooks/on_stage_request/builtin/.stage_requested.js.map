//CHECKSUM:3f4c298db106e11c6d2bcdb46a56bdb7a141cf23c889ff02f45c618b4db9d326
{"version":3,"sources":["../hooks/on_stage_request/.stage_requested.js"],"names":["stageChangeRequest","request_user","users","find","u","email","bot","pipeline_status","stage_request","requested_by","role","hookResult","actions"],"mappings":";;AAAA;;;;;;;;;;AAUA,MAAMA,kBAAkB,GAAG,YAAY;AACrC,QAAMC,YAAY,GAAGC,KAAK,CAACC,IAAN,CAAWC,CAAC,IAAIA,CAAC,CAACC,KAAF,IAAWC,GAAG,CAACC,eAAJ,CAAoBC,aAApB,CAAkCC,YAA7D,CAArB;;AACA,MAAI,CAACR,YAAD,IAAiBA,YAAY,CAACS,IAAb,KAAsB,SAA3C,EAAsD;AACpD;;;;AAIAC,IAAAA,UAAU,CAACC,OAAX,GAAqB,EAArB;AACA;AACD;AACF,CAVD;;AAYA,OAAOZ,kBAAkB,EAAzB","sourceRoot":"/var/lib/jenkins/workspace/build-linux/modules/builtin/src/backend","sourcesContent":["/**\n * This is called when a user requests to to promote abot to the next stage.\n * You can set the current stage of the bot to the next one\n *\n * @param bp The botpress SDK\n * @param bot The complete configuration of the bot\n * @param users The list of users of that workspace (email, role)\n * @param pipeline The list of configured stages\n * @param hookResult The result of the hook which contains actions\n */\nconst stageChangeRequest = async () => {\n  const request_user = users.find(u => u.email == bot.pipeline_status.stage_request.requested_by)\n  if (!request_user || request_user.role !== 'admin.*') {\n    /*\n    we want to keep the bot in the current stage and until another user with the right role promotes it\n    here would go an api call to your 3rd party notification service\n    */\n    hookResult.actions = []\n    return\n  }\n}\n\nreturn stageChangeRequest()\n"]}