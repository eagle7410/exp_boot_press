//CHECKSUM:b0f55e506763e16cbec462a3390cc2a08805aefc8b5ebbf0a5fa0724aa3eee8d
{"version":3,"sources":["../hooks/after_incoming_middleware/.02_set_session_reference.js"],"names":["hook","event","type","payload","signature","text","verifySignature","bp","security","getMessageSignature","Object","assign","state","session","reference","setFlag","IO","WellKnownFlags","SKIP_DIALOG_ENGINE","FORCE_PERSIST_STATE"],"mappings":";;AAAA,eAAeA,IAAf,GAAsB;AACpB,MAAIC,KAAK,CAACC,IAAN,KAAe,mBAAf,IAAsCD,KAAK,CAACE,OAAN,CAAcC,SAApD,IAAiEH,KAAK,CAACE,OAAN,CAAcE,IAAnF,EAAyF;AACvF,UAAMC,eAAe,GAAG,MAAMC,EAAE,CAACC,QAAH,CAAYC,mBAAZ,CAAgCR,KAAK,CAACE,OAAN,CAAcE,IAA9C,CAA9B;;AAEA,QAAIJ,KAAK,CAACE,OAAN,CAAcC,SAAd,KAA4BE,eAAhC,EAAiD;AAC/CI,MAAAA,MAAM,CAACC,MAAP,CAAcV,KAAK,CAACW,KAAN,CAAYC,OAA1B,EAAmC;AACjCC,QAAAA,SAAS,EAAEb,KAAK,CAACE,OAAN,CAAcE;AADQ,OAAnC;AAGAJ,MAAAA,KAAK,CAACc,OAAN,CAAcR,EAAE,CAACS,EAAH,CAAMC,cAAN,CAAqBC,kBAAnC,EAAuD,IAAvD;AACAjB,MAAAA,KAAK,CAACc,OAAN,CAAcR,EAAE,CAACS,EAAH,CAAMC,cAAN,CAAqBE,mBAAnC,EAAwD,IAAxD;AACD;AACF;AACF;;AAED,OAAOnB,IAAI,EAAX","sourceRoot":"/var/lib/jenkins/workspace/build-linux/modules/builtin/src/backend","sourcesContent":["async function hook() {\n  if (event.type === 'session_reference' && event.payload.signature && event.payload.text) {\n    const verifySignature = await bp.security.getMessageSignature(event.payload.text)\n\n    if (event.payload.signature === verifySignature) {\n      Object.assign(event.state.session, {\n        reference: event.payload.text\n      })\n      event.setFlag(bp.IO.WellKnownFlags.SKIP_DIALOG_ENGINE, true)\n      event.setFlag(bp.IO.WellKnownFlags.FORCE_PERSIST_STATE, true)\n    }\n  }\n}\n\nreturn hook()\n"]}