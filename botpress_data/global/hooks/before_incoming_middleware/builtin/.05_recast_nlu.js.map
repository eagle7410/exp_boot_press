//CHECKSUM:3b1232bc261ec72014666abf988bca14259a1b1f9968eee30d2d4d7e82aa0197
{"version":3,"sources":["../hooks/before_incoming_middleware/.05_recast_nlu.js"],"names":["axios","require","RECAST_TOKEN","process","env","eventTypes","recastExtract","includes","event","type","data","post","text","preview","headers","Authorization","results","nlu","intents","entities","language","sentiment","setFlag","bp","IO","WellKnownFlags","SKIP_NATIVE_NLU"],"mappings":";;AAAA;;;;AAKA,MAAMA,KAAK,GAAGC,OAAO,CAAC,OAAD,CAArB;;AAEA,MAAMC,YAAY,GAAGC,OAAO,CAACC,GAAR,CAAYF,YAAZ,IAA4B,4BAAjD;AAEA,MAAMG,UAAU,GAAG,CAAC,MAAD,CAAnB,C,CAA4B;;AAE5B,eAAeC,aAAf,GAA+B;AAC7B,MAAID,UAAU,CAACE,QAAX,CAAoBC,KAAK,CAACC,IAA1B,CAAJ,EAAqC;AACnC,UAAM;AAAEC,MAAAA;AAAF,QAAW,MAAMV,KAAK,CAACW,IAAN,CACrB,wCADqB,EAErB;AAAEC,MAAAA,IAAI,EAAEJ,KAAK,CAACK;AAAd,KAFqB,EAGrB;AACEC,MAAAA,OAAO,EAAE;AACPC,QAAAA,aAAa,EAAE,WAAWb;AADnB;AADX,KAHqB,CAAvB;;AAUA,QAAIQ,IAAI,IAAIA,IAAI,CAACM,OAAjB,EAA0B;AACxB;;AAEAR,MAAAA,KAAK,CAACS,GAAN,GAAYT,KAAK,CAACS,GAAN,IAAa,EAAzB;AACAT,MAAAA,KAAK,CAACS,GAAN,CAAUC,OAAV,GAAoBR,IAAI,CAACM,OAAL,CAAaE,OAAjC;AACAV,MAAAA,KAAK,CAACS,GAAN,CAAUE,QAAV,GAAqBT,IAAI,CAACM,OAAL,CAAaG,QAAlC;AACAX,MAAAA,KAAK,CAACS,GAAN,CAAUG,QAAV,GAAqBV,IAAI,CAACM,OAAL,CAAaI,QAAlC;AACAZ,MAAAA,KAAK,CAACS,GAAN,CAAUI,SAAV,GAAsBX,IAAI,CAACM,OAAL,CAAaK,SAAnC,CAPwB,CAQxB;;AACAb,MAAAA,KAAK,CAACc,OAAN,CAAcC,EAAE,CAACC,EAAH,CAAMC,cAAN,CAAqBC,eAAnC,EAAoD,IAApD;AACD;AACF;AACF;;AAED,OAAOpB,aAAa,EAApB","sourceRoot":"/var/lib/jenkins/workspace/build-linux/modules/builtin/src/backend","sourcesContent":["/**\n * This is an example of how to use Recast NLU instead of Botpress NLU\n * To enable this, remove the 'dot' before the name of this file\n */\n\nconst axios = require('axios')\n\nconst RECAST_TOKEN = process.env.RECAST_TOKEN || '<<your recast token here>>'\n\nconst eventTypes = ['text'] // Process only 'text' events\n\nasync function recastExtract() {\n  if (eventTypes.includes(event.type)) {\n    const { data } = await axios.post(\n      'https://api.recast.ai/train/v2/request',\n      { text: event.preview },\n      {\n        headers: {\n          Authorization: 'Token ' + RECAST_TOKEN\n        }\n      }\n    )\n\n    if (data && data.results) {\n      /** TODO Here you will need to manipulate the format of these objects\n       * so that they use the same format as Botpress NLU */\n      event.nlu = event.nlu || {}\n      event.nlu.intents = data.results.intents\n      event.nlu.entities = data.results.entities\n      event.nlu.language = data.results.language\n      event.nlu.sentiment = data.results.sentiment\n      // Disable Native NLU\n      event.setFlag(bp.IO.WellKnownFlags.SKIP_NATIVE_NLU, true)\n    }\n  }\n}\n\nreturn recastExtract()\n"]}